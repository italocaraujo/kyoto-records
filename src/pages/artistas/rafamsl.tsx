import { useEffect, useState, useRef } from "react";
import styles from "@/styles/artists/RafaMSL.module.css";
import Header from "@/components/Header";
import Footer from "@/components/Footer";
import ReleasesSection from "@/components/ReleasesSection"; // Import the new component
import ScrollToTopButton from "@/components/ScrollToTopButton";
import Head from "next/head";
import SecondNavbar from "@/components/SecondNavBar";

interface Release {
  title: string;
  date: string;
  cover: string;
  href: string;
}

export default function RafaMSL() {
  const [showScrollTop, setShowScrollTop] = useState(false);
  const sectionsRef = useRef<HTMLDivElement[]>([]);

  const releases: Release[] = [
    {
      title: "RafaMSL - Na Visão",
      date: "Released November 16, 2024",
      cover: "/assets/covers/rafaNaVisao.png",
      href: "https://open.spotify.com/intl-pt/track/1hlGhvnWXDFKVeLHEYWcYv?si=e5101093c17444bc",
    },
    {
      title: "Minele - Telecinese (feat. RafaMSL)",
      date: "Released August 16, 2024",
      cover: "/assets/covers/mineleTelecinese.png",
      href: "https://open.spotify.com/intl-pt/track/5EuvkAU25hURxOky05Z32g?si=519c58c2c6894bdc",
    },
  ];

  // === Fade-in for Banner ===
  useEffect(() => {
    const banner = document.querySelector<HTMLDivElement>(`.${styles.bannerImage}`);
    if (banner) {
      banner.style.opacity = "1";
      banner.style.transform = "scale(1)";
    }
  }, []);

  // === Scroll-to-top Button Visibility ===
  useEffect(() => {
    const handleScroll = () => {
      setShowScrollTop(window.scrollY > 300);
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  // === IntersectionObserver for Section Animations ===
  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add(styles.fadeInSection);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15 }
    );

    sectionsRef.current.forEach((section) => {
      if (section) {
        observer.observe(section);
      }
    });

    return () => observer.disconnect();
  }, []);

  // === Assign Refs to Sections Dynamically ===
  const setSectionRef = (el: HTMLElement | null, index: number) => {
    if (el instanceof HTMLDivElement) {
      sectionsRef.current[index] = el;
    }
  };

  // === Smooth Scroll to Top ===
  const scrollToTop = () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  return (
    <div className={styles.artistPage}>
      <Head>
        <title>RafaMSL | KyotoRecords</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
          rel="icon"
          href="/d-kyoto-cherry.ico"
          media="(prefers-color-scheme: light)"
        />
        <link
          rel="icon"
          href="/w-kyoto-cherry.ico"
          media="(prefers-color-scheme: dark)"
        />
      </Head>
      <Header />
      <SecondNavbar />

      {/* Banner */}
      <div className={styles.banner}>
        <div className={styles.bannerImage}></div>
        <div className={styles.bannerContent}>
          <h1>RafaMSL</h1>
          <p>
            Rafael Francisco, de 20 anos, descobriu sua paixão pela música aos 8 anos, quando subiu ao palco pela primeira vez. 
            Eclético e criativo, ele mergulha em diferentes estilos musicais, como trap, R&B, boombap, MPB, e outros, 
            sempre buscando capturar a essência de cada vibe que encontra.
          </p>
        </div>
      </div>

      {/* Principais Lançamentos */}
      <ReleasesSection
        releases={releases}
        setSectionRef={setSectionRef}
        sectionIndex={0}
      />

      {/* Social Links */}
      <section ref={(el) => setSectionRef(el, 1)} className={styles.socialLinks}>
        <h2>Conecte-se</h2>
        <div className={styles.links}>
          <a
            href="https://www.instagram.com/rafafmsl"
            target="_blank"
            rel="noopener noreferrer"
          >
            Instagram
          </a>
          <a
            href="https://open.spotify.com/intl-pt/artist/1wEZUcdy4Oi5Ti9YkRXMnJ?si=wbmrRBJETCqHHfH1N9SOuA"
            target="_blank"
            rel="noopener noreferrer"
          >
            Spotify
          </a>
          <a
            href="https://www.youtube.com/@kyoto.records"
            target="_blank"
            rel="noopener noreferrer"
          >
            YouTube
          </a>
        </div>
      </section>

      <Footer />

      <ScrollToTopButton />
    </div>
  );
}
